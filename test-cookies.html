<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cookie Consent</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #2c5f7c;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #2c5f7c;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        button {
            background: #2c5f7c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #4a9eba;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        code {
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>üç™ Test Cookie Consent System</h1>
    
    <div class="test-section">
        <h2>Status zg√≥d na pliki cookie</h2>
        <div id="consent-status"></div>
        <button onclick="checkConsent()">Sprawd≈∫ status</button>
        <button onclick="clearConsent()">Wyczy≈õƒá zgody (reset)</button>
    </div>

    <div class="test-section">
        <h2>Akcje testowe</h2>
        <button onclick="showBanner()">Poka≈º banner</button>
        <button onclick="showSettings()">Poka≈º ustawienia</button>
        <button onclick="acceptAll()">Akceptuj wszystkie</button>
        <button onclick="rejectAll()">Odrzuƒá wszystkie</button>
    </div>

    <div class="test-section">
        <h2>Sprawd≈∫ localStorage</h2>
        <div id="localstorage-content"></div>
        <button onclick="checkLocalStorage()">Sprawd≈∫ localStorage</button>
    </div>

    <div class="test-section">
        <h2>Sprawd≈∫ czy skrypty siƒô za≈Çadowa≈Çy</h2>
        <div id="scripts-status"></div>
        <button onclick="checkScripts()">Sprawd≈∫ skrypty</button>
    </div>

    <div class="test-section">
        <h2>Instrukcje testowania</h2>

        <h3>Test 1: Podstawowa funkcjonalno≈õƒá</h3>
        <ol>
            <li>Otw√≥rz tƒô stronƒô w trybie incognito (Ctrl+Shift+N)</li>
            <li>Kliknij "Sprawd≈∫ skrypty" - <strong>skrypty Google powinny byƒá ju≈º za≈Çadowane</strong> (nowa implementacja!)</li>
            <li>Kliknij "Sprawd≈∫ status" - powinno pokazaƒá "Brak zg√≥d"</li>
            <li>Kliknij "Poka≈º banner" - powinien pojawiƒá siƒô banner na dole</li>
            <li>Kliknij "Akceptuj wszystkie" w bannerze</li>
            <li>Kliknij "Sprawd≈∫ status" - powinno pokazaƒá wszystkie zgody jako TRUE</li>
            <li>Od≈õwie≈º stronƒô - banner nie powinien siƒô pokazaƒá</li>
        </ol>

        <h3>Test 2: Modyfikacja ustawie≈Ñ (FIX #2)</h3>
        <ol>
            <li>Po zaakceptowaniu wszystkich cookies (Test 1)</li>
            <li>Kliknij "Poka≈º ustawienia"</li>
            <li><strong>‚úÖ Checkboxy powinny byƒá zaznaczone</strong> (pokazujƒÖ aktualny stan zg√≥d)</li>
            <li>Odznacz "Pliki cookie marketingowe"</li>
            <li>Kliknij "Zapisz ustawienia"</li>
            <li>Kliknij "Sprawd≈∫ status" - marketing powinien byƒá FALSE</li>
            <li>Kliknij "Poka≈º ustawienia" ponownie</li>
            <li><strong>‚úÖ Marketing powinien byƒá odznaczony, analytics zaznaczony</strong></li>
        </ol>

        <h3>Test 3: Zamykanie ustawie≈Ñ (FIX #2)</h3>
        <ol>
            <li>Po zaakceptowaniu cookies</li>
            <li>Kliknij "Poka≈º ustawienia"</li>
            <li>Kliknij "X" (zamknij) bez zapisywania</li>
            <li><strong>‚úÖ Banner NIE powinien siƒô pojawiƒá ponownie</strong></li>
            <li>Ustawienia powinny siƒô po prostu zamknƒÖƒá</li>
        </ol>

        <div class="status info">
            <strong>‚ÑπÔ∏è Wa≈ºne:</strong> W nowej implementacji skrypty Google Ads i Analytics ≈ÇadujƒÖ siƒô od razu,
            ale nie zbierajƒÖ danych do momentu wyra≈ºenia zgody przez u≈ºytkownika. To pozwala Google zweryfikowaƒá
            obecno≈õƒá tagu na stronie, zachowujƒÖc zgodno≈õƒá z RODO.
        </div>
    </div>

    <script>
        function checkConsent() {
            const consent = localStorage.getItem('cookie_consent');
            const statusDiv = document.getElementById('consent-status');
            
            if (!consent) {
                statusDiv.innerHTML = '<div class="status error">‚ùå Brak zg√≥d - u≈ºytkownik nie podjƒÖ≈Ç jeszcze decyzji</div>';
            } else {
                const data = JSON.parse(consent);
                statusDiv.innerHTML = `
                    <div class="status success">‚úÖ Zgody zapisane:</div>
                    <pre><code>${JSON.stringify(data, null, 2)}</code></pre>
                    <div class="status info">
                        <strong>Niezbƒôdne:</strong> ${data.necessary ? '‚úÖ TAK' : '‚ùå NIE'}<br>
                        <strong>Analityczne:</strong> ${data.analytics ? '‚úÖ TAK' : '‚ùå NIE'}<br>
                        <strong>Marketingowe:</strong> ${data.marketing ? '‚úÖ TAK' : '‚ùå NIE'}<br>
                        <strong>Data zgody:</strong> ${new Date(data.timestamp).toLocaleString('pl-PL')}
                    </div>
                `;
            }
        }

        function clearConsent() {
            localStorage.removeItem('cookie_consent');
            document.cookie = 'cookie_consent=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            alert('Zgody zosta≈Çy wyczyszczone. Od≈õwie≈º stronƒô aby zobaczyƒá banner ponownie.');
            checkConsent();
        }

        function showBanner() {
            if (window.CookieConsent) {
                window.CookieConsent.showBanner();
            } else {
                alert('CookieConsent nie jest za≈Çadowany. Upewnij siƒô, ≈ºe cookie-consent.js jest do≈ÇƒÖczony.');
            }
        }

        function showSettings() {
            if (window.CookieConsent) {
                window.CookieConsent.showSettings();
            } else {
                alert('CookieConsent nie jest za≈Çadowany.');
            }
        }

        function acceptAll() {
            if (window.CookieConsent) {
                window.CookieConsent.acceptAll();
                setTimeout(checkConsent, 500);
            } else {
                alert('CookieConsent nie jest za≈Çadowany.');
            }
        }

        function rejectAll() {
            if (window.CookieConsent) {
                window.CookieConsent.rejectAll();
                setTimeout(checkConsent, 500);
            } else {
                alert('CookieConsent nie jest za≈Çadowany.');
            }
        }

        function checkLocalStorage() {
            const div = document.getElementById('localstorage-content');
            const allData = {};
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                allData[key] = localStorage.getItem(key);
            }
            
            div.innerHTML = `
                <div class="status info">Zawarto≈õƒá localStorage:</div>
                <pre><code>${JSON.stringify(allData, null, 2)}</code></pre>
            `;
        }

        function checkScripts() {
            const div = document.getElementById('scripts-status');
            const hasGtag = typeof window.gtag !== 'undefined';
            const hasDataLayer = typeof window.dataLayer !== 'undefined';
            const gaScripts = document.querySelectorAll('script[src*="googletagmanager.com/gtag/js"]');

            div.innerHTML = `
                <div class="status ${hasGtag ? 'success' : 'error'}">
                    ${hasGtag ? '‚úÖ' : '‚ùå'} Google gtag function: ${hasGtag ? 'Za≈Çadowany' : 'Nie za≈Çadowany'}
                </div>
                <div class="status ${hasDataLayer ? 'success' : 'error'}">
                    ${hasDataLayer ? '‚úÖ' : '‚ùå'} DataLayer: ${hasDataLayer ? 'Za≈Çadowany' : 'Nie za≈Çadowany'}
                </div>
                <div class="status ${gaScripts.length > 0 ? 'success' : 'error'}">
                    ${gaScripts.length > 0 ? '‚úÖ' : '‚ùå'} Skrypty Google: ${gaScripts.length} za≈Çadowanych
                </div>
                <div class="status info">
                    <strong>‚úÖ Nowa implementacja (Consent Mode v2):</strong> Skrypty Google ≈ÇadujƒÖ siƒô od razu,
                    ale nie zbierajƒÖ danych do momentu wyra≈ºenia zgody. To pozwala Google zweryfikowaƒá tag
                    na stronie, zachowujƒÖc zgodno≈õƒá z RODO.
                </div>
            `;
        }

        // Auto-check on load
        window.addEventListener('load', function() {
            checkConsent();
        });
    </script>

    <!-- Cookie Consent Banner -->
    <div id="cookie-consent-banner">
        <div class="cookie-banner-content">
            <div class="cookie-banner-text">
                <h3>üç™ Ta strona u≈ºywa plik√≥w cookie</h3>
                <p>
                    U≈ºywamy plik√≥w cookie i podobnych technologii, aby zapewniƒá prawid≈Çowe dzia≈Çanie strony,
                    analizowaƒá ruch oraz personalizowaƒá tre≈õci reklamowe.
                </p>
            </div>
            <div class="cookie-banner-buttons">
                <button id="cookie-accept-all" class="cookie-btn cookie-btn-primary">
                    Akceptujƒô wszystkie
                </button>
                <button id="cookie-reject-all" class="cookie-btn cookie-btn-secondary">
                    Odrzuƒá wszystkie
                </button>
                <button id="cookie-customize" class="cookie-btn cookie-btn-outline">
                    Dostosuj ustawienia
                </button>
            </div>
        </div>
    </div>

    <!-- Cookie Settings Panel -->
    <div id="cookie-settings">
        <div class="cookie-settings-header">
            <h3>Ustawienia plik√≥w cookie</h3>
            <button id="cookie-settings-close" class="cookie-settings-close" aria-label="Zamknij">√ó</button>
        </div>

        <div class="cookie-categories">
            <div class="cookie-category">
                <div class="cookie-category-header">
                    <h4>Niezbƒôdne pliki cookie</h4>
                    <span class="cookie-always-active">Zawsze aktywne</span>
                </div>
            </div>

            <div class="cookie-category">
                <div class="cookie-category-header">
                    <h4>Pliki cookie analityczne</h4>
                    <label class="cookie-toggle">
                        <input type="checkbox" id="cookie-analytics">
                        <span class="cookie-toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="cookie-category">
                <div class="cookie-category-header">
                    <h4>Pliki cookie marketingowe</h4>
                    <label class="cookie-toggle">
                        <input type="checkbox" id="cookie-marketing">
                        <span class="cookie-toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="cookie-settings-buttons">
            <button id="cookie-save-preferences" class="cookie-btn cookie-btn-primary">
                Zapisz ustawienia
            </button>
        </div>
    </div>

    <link rel="stylesheet" href="cookie-consent.css">
    <script src="cookie-consent.js"></script>
</body>
</html>

